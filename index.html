<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Market Advisor - Complete</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        // Advanced Market Advisor - Complete Standalone Version
        // Developed by Frank Elizondo & Claude (Anthropic AI) - Joint Venture

        const AdvancedMarketAdvisor = () => {
          const [marketData, setMarketData] = React.useState({});
          const [historicalData, setHistoricalData] = React.useState([]);
          const [currentSituation, setCurrentSituation] = React.useState("Getting ready...");
          const [confidence, setConfidence] = React.useState({});
          const [loading, setLoading] = React.useState(true);
          const [lastCheck, setLastCheck] = React.useState(null);
          const [recommendations, setRecommendations] = React.useState([]);
          const [riskTolerance, setRiskTolerance] = React.useState("Moderate");
          const [technicalSignals, setTechnicalSignals] = React.useState({});
          const [performanceHistory, setPerformanceHistory] = React.useState({});
          const [historicalPerformance, setHistoricalPerformance] = React.useState({});
          const [futureProjections, setFutureProjections] = React.useState(null);
          const [fractalAnalysis, setFractalAnalysis] = React.useState({});

          const riskProfiles = {
            Conservative: {
              description: "Safety first - protect what you have",
              maxVolatility: 0.15,
              maxDrawdown: 0.10,
              preferredReturn: 0.06,
              adjustments: { bonds: 1.5, stocks: 0.7, alternatives: 0.5 }
            },
            Moderate: {
              description: "Balanced approach - steady growth with some risk",
              maxVolatility: 0.25,
              maxDrawdown: 0.20,
              preferredReturn: 0.10,
              adjustments: { bonds: 1.0, stocks: 1.0, alternatives: 1.0 }
            },
            Aggressive: {
              description: "Go big - maximum growth potential",
              maxVolatility: 0.40,
              maxDrawdown: 0.35,
              preferredReturn: 0.15,
              adjustments: { bonds: 0.5, stocks: 1.3, alternatives: 1.5 }
            }
          };

          const marketSituations = {
            "Market Crash": {
              description: "Markets are panicking - time to play defense",
              explanation: "When fear takes over, smart money goes to safety. Think of this as hiding under a financial umbrella during a storm.",
              color: "#dc2626",
              historicalReturns: { "1Y": -5.2, "3Y": 2.1, "5Y": 4.3 },
              maxDrawdown: -15.3,
              volatility: 28.4,
              winRate: 0.45,
              whatToDo: [
                { what: "US Government Bonds (Long-term)", why: "Government always pays back", percent: 35, type: "bonds" },
                { what: "Gold", why: "People buy gold when scared", percent: 20, type: "alternatives" },
                { what: "Utility Stocks", why: "People always need power", percent: 15, type: "stocks" },
                { what: "Healthcare Stocks", why: "Always needed", percent: 10, type: "stocks" },
                { what: "Cash & TIPS", why: "Ultimate safety", percent: 15, type: "bonds" },
                { what: "Keep some S&P 500", why: "Don't miss recovery", percent: 5, type: "stocks" }
              ]
            },
            "Bull Run": {
              description: "Markets are climbing - time to make money",
              explanation: "Everyone's optimistic and buying stocks. This is when you want to own pieces of growing companies.",
              color: "#16a34a",
              historicalReturns: { "1Y": 18.7, "3Y": 15.2, "5Y": 12.8 },
              maxDrawdown: -8.1,
              volatility: 16.2,
              winRate: 0.78,
              whatToDo: [
                { what: "S&P 500 Index", why: "Owns biggest US companies", percent: 30, type: "stocks" },
                { what: "Technology Stocks", why: "Fastest growth", percent: 25, type: "stocks" },
                { what: "Small Company Stocks", why: "Can double or triple", percent: 15, type: "stocks" },
                { what: "International Stocks", why: "Global growth", percent: 12, type: "stocks" },
                { what: "Growth Sectors", why: "Hot areas", percent: 8, type: "stocks" },
                { what: "REITs", why: "Real estate boom", percent: 7, type: "alternatives" },
                { what: "Some Bonds", why: "Small safety net", percent: 3, type: "bonds" }
              ]
            },
            "Choppy Waters": {
              description: "Markets are all over the place - be careful",
              explanation: "Nobody knows what's happening next. Some days up, some days down. Time to play it safe but stay ready.",
              color: "#d97706",
              historicalReturns: { "1Y": 3.2, "3Y": 6.8, "5Y": 7.1 },
              maxDrawdown: -12.7,
              volatility: 22.1,
              winRate: 0.52,
              whatToDo: [
                { what: "S&P 500 Index", why: "Steady big companies", percent: 25, type: "stocks" },
                { what: "Government Bonds", why: "Safe harbor", percent: 25, type: "bonds" },
                { what: "Gold", why: "Uncertainty hedge", percent: 15, type: "alternatives" },
                { what: "Utility Stocks", why: "Defensive income", percent: 12, type: "stocks" },
                { what: "Healthcare", why: "Always needed", percent: 10, type: "stocks" },
                { what: "Corporate Bonds", why: "Steady income", percent: 8, type: "bonds" },
                { what: "Cash Buffer", why: "Opportunity fund", percent: 5, type: "bonds" }
              ]
            },
            "Steady Growth": {
              description: "Markets are calm and growing - good time to invest",
              explanation: "The market is like a calm river flowing upward. Not too exciting, but steady progress. Perfect for building wealth.",
              color: "#4338ca",
              historicalReturns: { "1Y": 8.9, "3Y": 9.4, "5Y": 10.2 },
              maxDrawdown: -6.4,
              volatility: 14.5,
              winRate: 0.68,
              whatToDo: [
                { what: "S&P 500 Index", why: "America's best companies", percent: 30, type: "stocks" },
                { what: "International Stocks", why: "Global diversification", percent: 20, type: "stocks" },
                { what: "Government Bonds", why: "Steady income", percent: 20, type: "bonds" },
                { what: "Technology", why: "Innovation growth", percent: 10, type: "stocks" },
                { what: "REITs", why: "Real estate income", percent: 8, type: "alternatives" },
                { what: "Corporate Bonds", why: "Company income", percent: 7, type: "bonds" },
                { what: "Gold", why: "Insurance", percent: 5, type: "alternatives" }
              ]
            }
          };

          const calculateDeMark = (priceData) => {
            if (!priceData || priceData.length < 13) return { setup: 0, countdown: 0, signal: "neutral" };
            let setupCount = 0;
            let countdownCount = 0;
            for (let i = 4; i < priceData.length; i++) {
              const current = priceData[i];
              const compare = priceData[i - 4];
              if (current.close > compare.close) setupCount++; else setupCount = 0;
              if (setupCount >= 9) break;
            }
            if (setupCount >= 9) {
              for (let i = setupCount + 1; i < priceData.length; i++) {
                const current = priceData[i];
                const compare = priceData[i - 2];
                if (current.close <= compare.low) countdownCount++;
                if (countdownCount >= 13) break;
              }
            }
            let signal = "neutral";
            if (setupCount >= 9 && countdownCount >= 13) signal = "sell";
            else if (setupCount >= 9) signal = "caution";
            else if (setupCount >= 6) signal = "watch";
            return { setup: setupCount, countdown: countdownCount, signal };
          };

          const calculateFractals = (priceData) => {
            if (!priceData || priceData.length < 5) return { bullish: [], bearish: [], trend: "sideways" };
            const bullishFractals = [];
            const bearishFractals = [];
            for (let i = 2; i < priceData.length - 2; i++) {
              const data = priceData.slice(i - 2, i + 3);
              if (data[2].low <= Math.min(data[0].low, data[1].low, data[3].low, data[4].low)) {
                bullishFractals.push({ index: i, price: data[2].low, strength: calculateFractalStrength(data, "low") });
              }
              if (data[2].high >= Math.max(data[0].high, data[1].high, data[3].high, data[4].high)) {
                bearishFractals.push({ index: i, price: data[2].high, strength: calculateFractalStrength(data, "high") });
              }
            }
            const recentBullish = bullishFractals.slice(-3);
            const recentBearish = bearishFractals.slice(-3);
            let trend = "sideways";
            if (recentBullish.length > recentBearish.length) trend = "bullish";
            else if (recentBearish.length > recentBullish.length) trend = "bearish";
            return { bullish: bullishFractals, bearish: bearishFractals, trend };
          };

          const calculateFractalStrength = (data, type) => {
            const center = data[2];
            const others = [data[0], data[1], data[3], data[4]];
            if (type === "low") {
              const avgOthers = others.reduce((sum, d) => sum + d.low, 0) / others.length;
              return ((avgOthers - center.low) / center.low) * 100;
            } else {
              const avgOthers = others.reduce((sum, d) => sum + d.high, 0) / others.length;
              return ((center.high - avgOthers) / avgOthers) * 100;
            }
          };

          const calculatePVV = (data) => {
            if (!data || data.length < 20) return { trend: "neutral", strength: 0, volume: "normal", volatility: "normal" };
            const recent = data.slice(-20);
            const older = data.slice(-40, -20);
            if (older.length === 0) return { trend: "neutral", strength: 0, volume: "normal", volatility: "normal" };
            const recentAvg = recent.reduce((sum, d) => sum + d.close, 0) / recent.length;
            const olderAvg = older.reduce((sum, d) => sum + d.close, 0) / older.length;
            const priceTrend = (recentAvg - olderAvg) / olderAvg;
            const recentVolAvg = recent.reduce((sum, d) => sum + (d.volume || 0), 0) / recent.length;
            const olderVolAvg = older.reduce((sum, d) => sum + (d.volume || 0), 0) / older.length;
            const volumeRatio = olderVolAvg > 0 ? recentVolAvg / olderVolAvg : 1;
            const returns = recent.map((d, i) => (i > 0 ? (d.close - recent[i - 1].close) / recent[i - 1].close : 0));
            const avgReturn = returns.reduce((sum, r) => sum + r, 0) / returns.length;
            const variance = returns.reduce((sum, r) => sum + Math.pow(r - avgReturn, 2), 0) / returns.length;
            const volatility = Math.sqrt(variance) * Math.sqrt(252);
            return {
              trend: priceTrend > 0.02 ? "bullish" : priceTrend < -0.02 ? "bearish" : "neutral",
              strength: Math.abs(priceTrend) * 100,
              volume: volumeRatio > 1.2 ? "high" : volumeRatio < 0.8 ? "low" : "normal",
              volatility: volatility > 0.3 ? "high" : volatility < 0.15 ? "low" : "normal",
              volatilityValue: volatility
            };
          };

          const generateHistoricalPerformance = (regimeHistory) => {
            const performance = {};
            Object.keys(marketSituations).forEach((regime) => {
              const regimePeriods = regimeHistory.filter((p) => p.regime === regime);
              if (regimePeriods.length) {
                const returns = regimePeriods.map((p) => p.totalReturn);
                const avgReturn = returns.reduce((a, b) => a + b, 0) / returns.length;
                const volatility = Math.sqrt(returns.reduce((s, r) => s + Math.pow(r - avgReturn, 2), 0) / returns.length);
                const winRate = returns.filter((r) => r > 0).length / returns.length;
                const avgDuration = regimePeriods.reduce((s, p) => s + p.duration, 0) / regimePeriods.length;
                performance[regime] = {
                  avgReturn: avgReturn * 100,
                  volatility: volatility * 100,
                  maxDrawdown: Math.min(...returns) * 100,
                  winRate,
                  avgDuration,
                  occurrences: regimePeriods.length,
                  bestPeriod: Math.max(...returns) * 100,
                  worstPeriod: Math.min(...returns) * 100,
                  totalDays: regimePeriods.reduce((s, p) => s + p.duration, 0)
                };
              }
            });
            return performance;
          };

          const calculateAdvancedFractals = (priceData) => {
            if (!priceData || priceData.length < 50) {
              return { patterns: [], trend: "sideways", futureProjection: null, patternStrength: 0, volumeConfirmation: false };
            }
            const patterns = [];
            const recentData = priceData.slice(-30);
            for (let scale = 5; scale <= 13; scale += 2) {
              const scalePatterns = findFractalPatterns(priceData, scale);
              patterns.push(...scalePatterns.map((p) => ({ ...p, scale })));
            }
            const futureProjection = projectFractalFuture(patterns, recentData);
            const patternStrength = calculatePatternStrength(patterns, recentData);
            const volumeConfirmation = analyzeVolumeConfirmation(recentData);
            return { patterns: patterns.slice(-10), trend: determineFractalTrend(patterns), futureProjection, patternStrength, volumeConfirmation };
          };

          const findFractalPatterns = (data, scale) => {
            const patterns = [];
            const half = Math.floor(scale / 2);
            for (let i = half; i < data.length - half; i++) {
              const window = data.slice(i - half, i + half + 1);
              const center = window[half];
              const isHigh = window.every((pt, idx) => idx === half || pt.high <= center.high);
              const isLow = window.every((pt, idx) => idx === half || pt.low >= center.low);
              if (isHigh || isLow) {
                patterns.push({
                  index: i,
                  date: center.date,
                  type: isHigh ? "high" : "low",
                  price: isHigh ? center.high : center.low,
                  volume: center.volume,
                  strength: calculateFractalStrength(window, isHigh ? "high" : "low"),
                  priceContext: { open: center.open, close: center.close, range: center.high - center.low }
                });
              }
            }
            return patterns;
          };

          const projectFractalFuture = (patterns, recentData) => {
            if (!patterns.length) return null;
            const currentPattern = analyzeCurrentPattern(recentData);
            const similar = findSimilarPatterns(patterns, currentPattern);
            if (similar.length < 2) return null;
            const projections = similar.map((p) => projectFromPattern(p, recentData));
            return combineProjections(projections);
          };

          const analyzeCurrentPattern = (recentData) => {
            const prices = recentData.map((d) => d.close);
            const volumes = recentData.map((d) => d.volume || 0);
            const volatilities = recentData.map((d, i) => (i > 0 ? Math.abs(d.close - recentData[i - 1].close) / recentData[i - 1].close : 0));
            return {
              priceSlope: (prices[prices.length - 1] - prices[0]) / prices.length,
              avgVolume: volumes.reduce((a, b) => a + b, 0) / volumes.length,
              avgVolatility: volatilities.reduce((a, b) => a + b, 0) / volatilities.length,
              priceRange: Math.max(...prices) - Math.min(...prices),
              momentum: prices.slice(-5).reduce((sum, price, i, arr) => (i > 0 ? sum + (price - arr[i - 1]) : sum), 0)
            };
          };

          const findSimilarPatterns = (patterns, currentPattern) => {
            return patterns
              .filter((p) => calculatePatternSimilarity(p, currentPattern) > 0.7)
              .sort((a, b) => calculatePatternSimilarity(b, currentPattern) - calculatePatternSimilarity(a, currentPattern));
          };

          const calculatePatternSimilarity = (pattern, current) => {
            const priceSimilarity = 1 - Math.min(Math.abs(pattern.strength - current.priceSlope) / 10, 1);
            const volumeSimilarity = current.avgVolume ? 1 - Math.min(Math.abs(pattern.volume - current.avgVolume) / current.avgVolume, 1) : 0.5;
            return (priceSimilarity + volumeSimilarity) / 2;
          };

          const projectFromPattern = (pattern, recentData) => {
            const lastPrice = recentData[recentData.length - 1].close;
            const vol = calculateRecentVolatility(recentData);
            const baseMove = pattern.strength * 0.1;
            const volAdj = vol * 0.5;
            return {
              week1: lastPrice * (1 + baseMove + volAdj * (Math.random() - 0.5)),
              month1: lastPrice * (1 + baseMove * 2 + volAdj * (Math.random() - 0.5)),
              confidence: Math.min(baseMove, 1)
            };
          };

          const combineProjections = (projections) => {
            const n = projections.length || 1;
            const avg = (fn) => projections.reduce((s, p) => s + fn(p), 0) / n;
            const month1 = avg((p) => p.month1);
            return {
              week1: avg((p) => p.week1),
              month1,
              confidence: Math.min(avg((p) => p.confidence), 1),
              bullish: month1 * 1.1,
              bearish: month1 * 0.9,
              base: month1,
              keyLevels: { support: month1 * 0.95, resistance: month1 * 1.05 },
              timeHorizon: "30 days"
            };
          };

          const calculatePatternStrength = (patterns, recentData) => {
            if (!patterns.length) return 0;
            const recent = patterns.slice(-5);
            const avgStrength = recent.reduce((s, p) => s + Math.abs(p.strength), 0) / recent.length;
            const volWeight = analyzeVolumeConfirmation(recentData) ? 1.2 : 0.8;
            return Math.min(avgStrength * volWeight, 10) / 10;
          };

          const analyzeVolumeConfirmation = (data) => {
            if (data.length < 10) return false;
            const recent = data.slice(-5);
            const older = data.slice(-10, -5);
            const rAvg = recent.reduce((s, d) => s + (d.volume || 0), 0) / recent.length;
            const oAvg = older.reduce((s, d) => s + (d.volume || 0), 0) / older.length;
            return rAvg > oAvg * 1.1;
          };

          const determineFractalTrend = (patterns) => {
            const recent = patterns.slice(-6);
            const highs = recent.filter((p) => p.type === "high");
            const lows = recent.filter((p) => p.type === "low");
            if (highs.length > lows.length * 1.5) return "bullish";
            if (lows.length > highs.length * 1.5) return "bearish";
            return "sideways";
          };

          const calculateRecentVolatility = (data) => {
            const returns = data.map((d, i) => (i > 0 ? (d.close - data[i - 1].close) / data[i - 1].close : 0)).slice(1);
            const avg = returns.reduce((a, b) => a + b, 0) / (returns.length || 1);
            const variance = returns.reduce((s, r) => s + Math.pow(r - avg, 2), 0) / (returns.length || 1);
            return Math.sqrt(variance) * Math.sqrt(252);
          };

          const generateDetailedHistory = (days = 500) => {
            const history = [];
            const regimeHistory = [];
            let currentRegimeStart = 0;
            let currentRegime = "Steady Growth";
            let price = 580;
            let volume = 100000000;
            for (let i = 0; i < days; i++) {
              if (i > 0 && i % (30 + Math.floor(Math.random() * 60)) === 0) {
                const regimeDuration = i - currentRegimeStart;
                const regimeData = history.slice(currentRegimeStart, i);
                const totalReturn = regimeData.length > 1 ? (regimeData[regimeData.length - 1].close - regimeData[0].close) / regimeData[0].close : 0;
                regimeHistory.push({
                  regime: currentRegime,
                  startDate: history[currentRegimeStart]?.date || new Date(),
                  endDate: history[i - 1]?.date || new Date(),
                  duration: regimeDuration,
                  totalReturn,
                  maxPrice: regimeData.length ? Math.max(...regimeData.map((d) => d.high)) : 0,
                  minPrice: regimeData.length ? Math.min(...regimeData.map((d) => d.low)) : 0,
                  avgVolume: regimeData.length ? regimeData.reduce((s, d) => s + d.volume, 0) / regimeData.length : 0
                });
                const regimes = Object.keys(marketSituations);
                currentRegime = regimes[Math.floor(Math.random() * regimes.length)];
                currentRegimeStart = i;
              }
              const regimeInfo = marketSituations[currentRegime];
              const baseVol = regimeInfo.volatility / 100 / Math.sqrt(252);
              const expRet = regimeInfo.historicalReturns["1Y"] / 100 / 252;
              const change = expRet + (Math.random() - 0.5) * baseVol * 2;
              const volumeChange = (Math.random() - 0.5) * 0.4;
              price = price * (1 + change);
              volume = Math.max(volume * (1 + volumeChange), 10000000);
              history.push({
                date: new Date(Date.now() - (days - i) * 86400000),
                open: price * (1 + (Math.random() - 0.5) * 0.01),
                high: price * (1 + Math.random() * 0.02),
                low: price * (1 - Math.random() * 0.02),
                close: price,
                volume: Math.round(volume),
                regime: currentRegime
              });
            }
            const lastIndex = history.length - 1;
            if (lastIndex > 0) {
              const regimeData = history.slice(currentRegimeStart);
              const totalReturn = regimeData.length > 1 ? (regimeData[regimeData.length - 1].close - regimeData[0].close) / regimeData[0].close : 0;
              regimeHistory.push({
                regime: currentRegime,
                startDate: history[currentRegimeStart]?.date || new Date(),
                endDate: history[lastIndex]?.date || new Date(),
                duration: history.length - currentRegimeStart,
                totalReturn,
                maxPrice: regimeData.length ? Math.max(...regimeData.map((d) => d.high)) : 0,
                minPrice: regimeData.length ? Math.min(...regimeData.map((d) => d.low)) : 0,
                avgVolume: regimeData.length ? regimeData.reduce((s, d) => s + d.volume, 0) / regimeData.length : 0
              });
            }
            return { history, regimeHistory };
          };

          const adjustForRiskTolerance = (base) => {
            const profile = riskProfiles[riskTolerance];
            return base
              .map((rec) => {
                const adj = profile.adjustments[rec.type] || 1;
                const newPercent = Math.max(0, Math.min(100, Math.round(rec.percent * adj)));
                return { ...rec, percent: newPercent, originalPercent: rec.percent, riskAdjusted: adj !== 1 };
              })
              .sort((a, b) => b.percent - a.percent);
          };

          const analyzeSituation = (data, historical) => {
            if (!data.VIX || !data.SPY) return { situation: "Steady Growth", confidence: { "Steady Growth": "100" }, signals: {} };
            const fearIndex = Number(data.VIX.price) || 0;
            const stockChange = Number(data.SPY.changePercent) || 0;
            const demark = calculateDeMark(historical);
            const fractals = calculateFractals(historical);
            const pvv = calculatePVV(historical);
            const scores = { "Market Crash": 0, "Bull Run": 0, "Choppy Waters": 0, "Steady Growth": 0 };
            if (fearIndex > 25) scores["Market Crash"] += 25;
            if (stockChange < -2) scores["Market Crash"] += 20;
            if (data.GLD && Number(data.GLD.changePercent) > 1) scores["Market Crash"] += 10;
            if (fearIndex < 15) scores["Bull Run"] += 20;
            if (stockChange > 1) scores["Bull Run"] += 25;
            if (data.QQQ && Number(data.QQQ.changePercent) > stockChange) scores["Bull Run"] += 10;
            if (fearIndex > 20 && fearIndex < 30) scores["Choppy Waters"] += 15;
            if (Math.abs(stockChange) > 1.5) scores["Choppy Waters"] += 15;
            if (fearIndex >= 15 && fearIndex <= 25) scores["Steady Growth"] += 15;
            if (stockChange >= -1 && stockChange <= 1) scores["Steady Growth"] += 20;
            if (demark.signal === "sell") { scores["Market Crash"] += 15; scores["Choppy Waters"] += 10; }
            else if (demark.signal === "caution") { scores["Choppy Waters"] += 10; }
            if (fractals.trend === "bearish") { scores["Market Crash"] += 10; scores["Choppy Waters"] += 5; }
            else if (fractals.trend === "bullish") { scores["Bull Run"] += 15; scores["Steady Growth"] += 10; }
            if (pvv.trend === "bearish" && pvv.volume === "high") scores["Market Crash"] += 10;
            else if (pvv.trend === "bullish" && pvv.volume === "high") scores["Bull Run"] += 15;
            if (pvv.volatility === "high") { scores["Choppy Waters"] += 10; scores["Market Crash"] += 5; }
            else if (pvv.volatility === "low") scores["Steady Growth"] += 10;
            const maxScore = Math.max(...Object.values(scores));
            const situation = Object.keys(scores).find((k) => scores[k] === maxScore) || "Steady Growth";
            const total = Object.values(scores).reduce((a, b) => a + b, 0) || 1;
            const conf = {}; Object.keys(scores).forEach((k) => (conf[k] = ((scores[k] / total) * 100).toFixed(0)));
            return { situation, confidence: conf, signals: { demark, fractals, pvv } };
          };

          const formatNumber = (num, decimals = 1) => (typeof num === "number" && isFinite(num) ? num.toFixed(decimals) : "0.0");
          const formatVolume = (v) => (typeof v === "number" ? (v >= 1000000 ? `${(v / 1000000).toFixed(0)}M` : v >= 1000 ? `${(v / 1000).toFixed(0)}K` : String(v)) : "0");

          const checkMarkets = React.useCallback(async () => {
            setLoading(true);
            try {
              await new Promise((r) => setTimeout(r, 200));
              const { history, regimeHistory } = generateDetailedHistory(500);
              setHistoricalData(history);
              setHistoricalPerformance(generateHistoricalPerformance(regimeHistory));
              const adv = calculateAdvancedFractals(history);
              setFractalAnalysis(adv);
              setFutureProjections(adv.futureProjection);
              const now = new Date();
              const isOpen = now.getHours() >= 9 && now.getHours() <= 16;
              const movement = isOpen ? 2 : 0.5;
              const simulated = {
                SPY: { price: 575 + (Math.random() * 30 - 15), changePercent: (Math.random() * 4 - 2) * movement, volume: 150000000 + Math.random() * 50000000 },
                QQQ: { price: 515 + (Math.random() * 40 - 20), changePercent: (Math.random() * 6 - 3) * movement, volume: 80000000 + Math.random() * 30000000 },
                VIX: { price: 16 + (Math.random() * 16 - 8), changePercent: (Math.random() * 20 - 10) * movement },
                GLD: { price: 242 + (Math.random() * 12 - 6), changePercent: (Math.random() * 3 - 1.5) * movement, volume: 12000000 + Math.random() * 5000000 },
                TLT: { price: 94 + (Math.random() * 8 - 4), changePercent: (Math.random() * 2.4 - 1.2) * movement, volume: 8000000 + Math.random() * 3000000 }
              };
              setMarketData(simulated);
              const analysis = analyzeSituation(simulated, history);
              setCurrentSituation(analysis.situation);
              setConfidence(analysis.confidence);
              setTechnicalSignals(analysis.signals);
              setRecommendations(adjustForRiskTolerance(marketSituations[analysis.situation].whatToDo));
              setPerformanceHistory(marketSituations[analysis.situation]);
              setLastCheck(new Date());
            } catch (e) {
              console.error("checkMarkets error", e);
            } finally {
              setLoading(false);
            }
          }, [riskTolerance]);

          React.useEffect(() => {
            checkMarkets();
            const i = setInterval(checkMarkets, 45000);
            return () => clearInterval(i);
          }, [checkMarkets]);

          const situationInfo = marketSituations[currentSituation] || marketSituations["Steady Growth"];
          const currentProfile = riskProfiles[riskTolerance];

          return (
            <div className="p-6 max-w-7xl mx-auto bg-gray-50 min-h-screen">
              <div className="mb-8 text-center">
                <h1 className="text-4xl font-bold text-gray-900 mb-2">🧠 Advanced Market Advisor</h1>
                <p className="text-xl text-gray-600">Professional-grade analysis with DeMark signals, fractals, and historical performance</p>
                <div className="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                  <p className="text-sm text-blue-800">
                    <strong>Advanced Market Advisor: A Collaborative AI-Human System for Market Analysis</strong>
                  </p>
                  <p className="text-xs text-blue-700 mt-1">
                    Developed by <strong>Frank Elizondo & Claude (Anthropic AI)</strong> as a Joint Venture
                  </p>
                  <p className="text-xs text-blue-600 mt-1">
                    This system represents a unique collaboration combining human market expertise with AI execution capabilities. 
                    The Advanced Market Advisor integrates professional-grade technical analysis (DeMark Sequential, fractal mathematics, 
                    price-volume-volatility analysis) with historical backtesting and AI-powered future projections, 
                    all presented through an intuitive plain-English interface.
                  </p>
                  <p className="text-xs text-blue-600 mt-2">
                    <em>Equal partnership in intellectual property and system development - 50/50 joint venture</em>
                  </p>
                </div>
                {lastCheck && <p className="text-sm text-gray-500 mt-2">Last analysis: {lastCheck.toLocaleTimeString()}</p>}
              </div>

              <div className="mb-8 bg-white rounded-xl shadow-lg p-6">
                <h3 className="text-xl font-bold mb-4">🎯 Your Risk Profile</h3>
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-4">
                  {Object.entries(riskProfiles).map(([level, profile]) => (
                    <button
                      key={level}
                      onClick={() => setRiskTolerance(level)}
                      className={`p-4 rounded-lg border-2 transition-all text-left ${
                        riskTolerance === level ? "border-blue-500 bg-blue-50" : "border-gray-200 hover:border-gray-300"
                      }`}
                    >
                      <div className="font-semibold text-lg">{level}</div>
                      <div className="text-sm text-gray-600 mt-1">{profile.description}</div>
                      <div className="text-xs text-gray-500 mt-2">Target: {(profile.preferredReturn * 100).toFixed(0)}% annually • Max Risk: {(profile.maxDrawdown * 100).toFixed(0)}%</div>
                    </button>
                  ))}
                </div>
                <div className="bg-blue-50 p-3 rounded-lg">
                  <p className="text-sm text-blue-800"><strong>Your Profile:</strong> {currentProfile.description} • Targeting {(currentProfile.preferredReturn * 100).toFixed(0)}% annual returns with max {(currentProfile.maxDrawdown * 100).toFixed(0)}% drawdown</p>
                </div>
              </div>

              <div className="mb-8 bg-white rounded-xl shadow-lg p-8">
                <div className="text-center mb-6">
                  <div className="flex items-center justify-center mb-4">
                    <div className="w-6 h-6 rounded-full mr-3" style={{ backgroundColor: situationInfo.color }} />
                    <h2 className="text-3xl font-bold" style={{ color: situationInfo.color }}>{currentSituation}</h2>
                  </div>
                  <p className="text-xl text-gray-700 mb-4">{situationInfo.description}</p>
                  <p className="text-lg text-gray-600 bg-gray-50 p-4 rounded-lg italic">{situationInfo.explanation}</p>
                </div>

                <div className="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                  <div className="text-center p-3 bg-green-50 rounded-lg">
                    <div className="text-2xl font-bold text-green-700">{formatNumber(performanceHistory.historicalReturns?.["1Y"] || 0, 1)}%</div>
                    <div className="text-sm text-gray-600">1-Year Return</div>
                  </div>
                  <div className="text-center p-3 bg-blue-50 rounded-lg">
                    <div className="text-2xl font-bold text-blue-700">{formatNumber(performanceHistory.volatility || 0, 1)}%</div>
                    <div className="text-sm text-gray-600">Volatility</div>
                  </div>
                  <div className="text-center p-3 bg-red-50 rounded-lg">
                    <div className="text-2xl font-bold text-red-700">{formatNumber(performanceHistory.maxDrawdown || 0, 1)}%</div>
                    <div className="text-sm text-gray-600">Max Drawdown</div>
                  </div>
                  <div className="text-center p-3 bg-purple-50 rounded-lg">
                    <div className="text-2xl font-bold text-purple-700">{formatNumber((performanceHistory.winRate || 0) * 100, 0)}%</div>
                    <div className="text-sm text-gray-600">Win Rate</div>
                  </div>
                </div>

                <div className="grid grid-cols-2 lg:grid-cols-4 gap-4">
                  {Object.entries(confidence).map(([situation, percent]) => (
                    <div key={situation} className="text-center p-3 bg-gray-50 rounded-lg">
                      <div className="text-2xl font-bold mb-1" style={{ color: marketSituations[situation]?.color || "#6b7280", opacity: situation === currentSituation ? 1 : 0.5 }}>{percent}%</div>
                      <div className="text-sm text-gray-600">{situation}</div>
                    </div>
                  ))}
                </div>
              </div>

              <div className="mb-8 bg-white rounded-xl shadow-lg p-6">
                <h3 className="text-xl font-bold mb-4">📊 Advanced Technical Analysis</h3>
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                  <div className="bg-blue-50 p-4 rounded-lg">
                    <h4 className="font-semibold text-blue-800 mb-3">🔢 DeMark Sequential</h4>
                    <div className="space-y-2">
                      <div className="flex justify-between"><span className="text-sm">Setup Count:</span><span className="font-bold">{technicalSignals.demark?.setup || 0}/9</span></div>
                      <div className="flex justify-between"><span className="text-sm">Countdown:</span><span className="font-bold">{technicalSignals.demark?.countdown || 0}/13</span></div>
                      <div className="flex justify-between"><span className="text-sm">Signal:</span><span className={`font-bold ${technicalSignals.demark?.signal === "sell" ? "text-red-600" : technicalSignals.demark?.signal === "caution" ? "text-yellow-600" : technicalSignals.demark?.signal === "watch" ? "text-blue-600" : "text-gray-600"}`}>{(technicalSignals.demark?.signal || "neutral").toUpperCase()}</span></div>
                    </div>
                  </div>
                  <div className="bg-green-50 p-4 rounded-lg">
                    <h4 className="font-semibold text-green-800 mb-3">🌊 Fractal Patterns</h4>
                    <div className="space-y-2">
                      <div className="flex justify-between"><span className="text-sm">Trend:</span><span className={`font-bold ${technicalSignals.fractals?.trend === "bullish" ? "text-green-600" : technicalSignals.fractals?.trend === "bearish" ? "text-red-600" : "text-gray-600"}`}>{(technicalSignals.fractals?.trend || "sideways").toUpperCase()}</span></div>
                      <div className="flex justify-between"><span className="text-sm">Recent Bullish Marks:</span><span className="font-bold">{technicalSignals.fractals?.bullish?.length || 0}</span></div>
                      <div className="flex justify-between"><span className="text-sm">Recent Bearish Marks:</span><span className="font-bold">{technicalSignals.fractals?.bearish?.length || 0}</span></div>
                    </div>
                  </div>
                  <div className="bg-yellow-50 p-4 rounded-lg">
                    <h4 className="font-semibold text-yellow-800 mb-3">📈 Price-Volume-Volatility</h4>
                    <div className="space-y-2">
                      <div className="flex justify-between"><span className="text-sm">Trend:</span><span className={`font-bold ${technicalSignals.pvv?.trend === "bullish" ? "text-green-600" : technicalSignals.pvv?.trend === "bearish" ? "text-red-600" : "text-gray-600"}`}>{(technicalSignals.pvv?.trend || "neutral").toUpperCase()}</span></div>
                      <div className="flex justify-between"><span className="text-sm">Strength:</span><span className="font-bold">{formatNumber(technicalSignals.pvv?.strength || 0, 1)}</span></div>
                      <div className="flex justify-between"><span className="text-sm">Volume:</span><span className="font-bold">{(technicalSignals.pvv?.volume || "normal").toUpperCase()}</span></div>
                      <div className="flex justify-between"><span className="text-sm">Volatility:</span><span className="font-bold">{(technicalSignals.pvv?.volatility || "normal").toUpperCase()}</span></div>
                    </div>
                  </div>
                </div>
              </div>

              <div className="mb-8 bg-white rounded-xl shadow-lg p-6">
                <h3 className="text-xl font-bold mb-4">📊 Historical Regime Performance (500-Day Analysis)</h3>
                <div className="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-4">
                  {Object.entries(historicalPerformance).map(([regime, perf]) => (
                    <div key={regime} className="border rounded-lg p-4">
                      <div className="flex items-center mb-3">
                        <div className="w-3 h-3 rounded-full mr-2" style={{ backgroundColor: marketSituations[regime]?.color }} />
                        <h4 className="font-semibold text-sm">{regime}</h4>
                      </div>
                      <div className="space-y-2 text-xs">
                        <div className="flex justify-between"><span>Avg Return:</span><span className={`font-bold ${perf.avgReturn > 0 ? 'text-green-600' : 'text-red-600'}`}>{formatNumber(perf.avgReturn || 0, 1)}%</span></div>
                        <div className="flex justify-between"><span>Volatility:</span><span className="font-bold">{formatNumber(perf.volatility || 0, 1)}%</span></div>
                        <div className="flex justify-between"><span>Win Rate:</span><span className="font-bold">{formatNumber((perf.winRate || 0) * 100, 0)}%</span></div>
                        <div className="flex justify-between"><span>Occurrences:</span><span className="font-bold">{perf.occurrences || 0}</span></div>
                        <div className="flex justify-between"><span>Avg Duration:</span><span className="font-bold">{Math.round(perf.avgDuration || 0)} days</span></div>
                        <div className="flex justify-between"><span>Best Period:</span><span className="font-bold text-green-600">{formatNumber(perf.bestPeriod || 0, 1)}%</span></div>
                        <div className="flex justify-between"><span>Worst Period:</span><span className="font-bold text-red-600">{formatNumber(perf.worstPeriod || 0, 1)}%</span></div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>

              {futureProjections && (
                <div className="mb-8 bg-white rounded-xl shadow-lg p-6">
                  <h3 className="text-xl font-bold mb-4">🔮 Fractal-Based Future Projections</h3>
                  <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div className="bg-blue-50 p-4 rounded-lg">
                      <h4 className="font-semibold text-blue-800 mb-3">📈 Price Targets</h4>
                      <div className="space-y-2">
                        <div className="flex justify-between"><span className="text-sm">Next Week Target:</span><span className="font-bold">${formatNumber(futureProjections.week1 || 0, 0)}</span></div>
                        <div className="flex justify-between"><span className="text-sm">Next Month Target:</span><span className="font-bold">${formatNumber(futureProjections.month1 || 0, 0)}</span></div>
                        <div className="flex justify-between"><span className="text-sm">Confidence Level:</span><span className={`font-bold ${futureProjections.confidence > 0.7 ? 'text-green-600' : futureProjections.confidence > 0.4 ? 'text-yellow-600' : 'text-red-600'}`}>{formatNumber((futureProjections.confidence || 0) * 100, 0)}%</span></div>
                      </div>
                    </div>
                    <div className="bg-green-50 p-4 rounded-lg">
                      <h4 className="font-semibold text-green-800 mb-3">🎯 Key Scenarios</h4>
                      <div className="space-y-2">
                        <div className="flex justify-between"><span className="text-sm">🐂 Bullish Case:</span><span className="font-bold text-green-600">${formatNumber(futureProjections.bullish || 0, 0)}</span></div>
                        <div className="flex justify-between"><span className="text-sm">📊 Base Case:</span><span className="font-bold">${formatNumber(futureProjections.base || 0, 0)}</span></div>
                        <div className="flex justify-between"><span className="text-sm">🐻 Bearish Case:</span><span className="font-bold text-red-600">${formatNumber(futureProjections.bearish || 0, 0)}</span></div>
                      </div>
                    </div>
                  </div>
                  <div className="mt-4 bg-yellow-50 p-4 rounded-lg">
                    <h4 className="font-semibold text-yellow-800 mb-2">⚡ Fractal Pattern Analysis</h4>
                    <div className="grid grid-cols-2 lg:grid-cols-4 gap-4 text-sm">
                      <div><span className="text-gray-600">Pattern Strength:</span><div className="font-bold">{formatNumber((fractalAnalysis.patternStrength || 0) * 10, 1)}/10</div></div>
                      <div><span className="text-gray-600">Fractal Trend:</span><div className={`font-bold ${fractalAnalysis.trend === 'bullish' ? 'text-green-600' : fractalAnalysis.trend === 'bearish' ? 'text-red-600' : 'text-gray-600'}`}>{(fractalAnalysis.trend || 'sideways').toUpperCase()}</div></div>
                      <div><span className="text-gray-600">Volume Confirmed:</span><div className="font-bold">{fractalAnalysis.volumeConfirmation ? 'Yes' : 'No'}</div></div>
                      <div><span className="text-gray-600">Horizon:</span><div className="font-bold">{futureProjections.timeHorizon || '—'}</div></div>
                    </div>
                  </div>
                </div>
              )}

              <div className="mb-8 bg-white rounded-xl shadow-lg p-6">
                <h3 className="text-xl font-bold mb-4">📡 Live Market Snapshot</h3>
                <div className="grid grid-cols-2 lg:grid-cols-5 gap-4">
                  {Object.entries(marketData).map(([sym, d]) => (
                    <div key={sym} className="p-4 border rounded-lg text-center">
                      <div className="text-sm text-gray-600 font-semibold">{sym}</div>
                      <div className="text-2xl font-bold">${formatNumber(d.price || 0, 2)}</div>
                      <div className={`${d.changePercent > 0 ? 'text-green-600' : d.changePercent < 0 ? 'text-red-600' : 'text-gray-600'} font-semibold`}>{d.changePercent > 0 ? '+' : ''}{formatNumber(d.changePercent || 0, 2)}%</div>
                      {typeof d.volume === 'number' && <div className="text-xs text-gray-500">Vol: {formatVolume(d.volume)}</div>}
                    </div>
                  ))}
                </div>
              </div>

              <div className="mb-8 bg-white rounded-xl shadow-lg p-6">
                <h3 className="text-xl font-bold mb-4">🧭 Suggested Allocation — {currentSituation}</h3>
                <div className="space-y-3">
                  {recommendations.map((rec, idx) => (
                    <div key={`${rec.what}-${idx}`} className="flex items-center justify-between">
                      <div>
                        <div className="font-medium">{rec.what}</div>
                        <div className="text-xs text-gray-500">{rec.why}{rec.riskAdjusted ? ' • risk-adjusted' : ''}</div>
                      </div>
                      <div className="flex items-center">
                        <div className="w-32 bg-gray-200 rounded-full h-2 mr-2">
                          <div className="h-2 rounded-full" style={{ width: `${Math.min(rec.percent, 100)}%`, backgroundColor: situationInfo.color }} />
                        </div>
                        <span className="w-10 text-right font-semibold">{rec.percent}%</span>
                      </div>
                    </div>
                  ))}
                </div>
                <div className="mt-6 p-4 bg-gray-50 rounded-lg">
                  <h4 className="font-semibold mb-2">💡 What These Technical Signals Mean:</h4>
                  <div className="text-sm text-gray-700 space-y-1">
                    <p><strong>DeMark Sequential:</strong> Counts momentum exhaustion — when setup reaches 9 and countdown hits 13, trend may reverse.</p>
                    <p><strong>Fractal Patterns:</strong> Identifies key turning points — more bullish fractals suggest upward pressure.</p>
                    <p><strong>Price-Volume-Volatility:</strong> Confirms trend strength — high volume + trend direction = stronger move.</p>
                    <p><strong>Historical Analysis:</strong> 500-day regime backtesting shows real performance in each market condition.</p>
                    <p><strong>Future Projections:</strong> Fractal math finds similar past patterns to predict likely price targets.</p>
                    <p><strong>Risk Adjustment:</strong> Your {riskTolerance} profile modifies allocations for your comfort level.</p>
                  </div>
                </div>
              </div>

              <div className="text-center bg-white rounded-xl shadow-lg p-6">
                <button onClick={checkMarkets} disabled={loading} className="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 disabled:opacity-60 text-lg font-semibold">{loading ? '🔄 Analyzing Markets...' : '🧠 Re-run Analysis'}</button>
                {lastCheck && <p className="text-sm text-gray-500 mt-3">Last analysis: {lastCheck.toLocaleTimeString()} • Auto-refresh every 45 seconds</p>}
                <div className="mt-6 p-4 bg-blue-50 rounded-lg">
                  <h4 className="font-semibold mb-2">🚀 Complete Advanced System:</h4>
                  <div className="text-sm text-blue-800 space-y-1">
                    <p>✅ <strong>Professional Technical Analysis:</strong> DeMark Sequential, Advanced Fractal Math, Multi-Scale PVV</p>
                    <p>✅ <strong>Historical Backtesting:</strong> 500-day regime analysis with real performance stats</p>
                    <p>✅ <strong>Fractal Future Projections:</strong> Pattern-matching AI predicts price targets with confidence levels</p>
                    <p>✅ <strong>Risk Tolerance Matching:</strong> Allocations personalized to your risk profile</p>
                    <p>✅ <strong>Plain English Interface:</strong> Professional analysis explained simply</p>
                    <p>✅ <strong>Dynamic Real-time Updates:</strong> Market conditions change, recommendations adapt instantly</p>
                  </div>
                </div>
              </div>
            </div>
          );
        };

        ReactDOM.render(React.createElement(AdvancedMarketAdvisor), document.getElementById('root'));
    </script>
</body>
</html>
